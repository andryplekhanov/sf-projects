# Проектная работа 6 (HW-03)

## Задачи

- Создать 3 ВМ в Я.Облаке (минимальная конфигурация: 2vCPU, 2GB RAM, 20 GB HDD): **vm1** и **vm2** (Ubuntu 20.04), **vm3** (Centos 8).
- Установить на **vm1** Ansible.
- Создать на **vm1** пользователя для Ansible.
- Настроить авторизацию по ключу для этого пользователя с **vm1** на **vm2** и **vm3**.
- Добавить в **inventory** информацию о созданных машинах. **vm2** и **vm3** должны быть в группе **app**, **vm1** — в группе **database** и **web**.
- Написать плейбук, реализующий следующее:
   - на машинах группы **app** выполняется установка и запуск **Docker**;
   - на машинах группы **database** выполняется установка и запуск **postgresql-server** (версия и data-директория должны быть переменными, задающимися в **inventory**).
- Протестировать написанный плейбук.


## Решение

Все пункты выполняются автоматически с помощью **Terraform** и **Ansible**.

**! ВНИМАНИЕ !** Файлы **"inventory.ini"** и **"variables.yml"** для Ansible создаются автоматически во время работы Terraform. Без запуска Terraform не получится запустить Ansible.


## Запуск

- **Terraform** и **Ansible** должны быть установлены на вашей системе Linux.
- Скачать проект
- Перейти в директорию `sf-projects/project-6_HW-03/terraform`
- В файле `variables.tf` прописать значения для переменных **"cloud_id"**, **"folder_id"** и **"token"** от вашего Yandex Cloud
- Запустить команды `terraform init` и `terraform apply`
- Подождать 3-5 мин. пока инстансы заварятся и настоятся
- Перейти в директорию `sf-projects/project-6_HW-03/ansible`
- Запустить команду `ansible-playbook playbook.yml -i inventory.ini`
- Подключиться по ssh к **vm1**: `ssh ansible@<ip-vm1>`
- Подключиться по ssh с **vm1** на **vm2** или **vm3**: `ssh ansible@<ip-vm>`
- Не забываем в конце удалить инстансы: `terraform destroy`
